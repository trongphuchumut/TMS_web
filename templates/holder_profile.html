{% extends "base.html" %}

{% block title %}Th√¥ng tin Holder{% endblock %}

{% block extra_css %}
<style>
  .holder-page {
    max-width: 1120px;
    margin: 0 auto;
    padding: 16px 0 32px;
  }

  /* ========= BREADCRUMB & HEADER ========= */
  .hp-breadcrumb {
    font-size: 13px;
    color: #6b7280;
    margin-bottom: 8px;
  }
  .hp-breadcrumb a {
    color: #4b5563;
    text-decoration: none;
  }
  .hp-breadcrumb span {
    margin: 0 4px;
  }

  .hp-header {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 16px;
    margin-bottom: 16px;
  }
  .hp-title-block {
    display: flex;
    flex-direction: column;
    gap: 6px;
  }
  .hp-main-title-row {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
  }
  .hp-main-title {
    font-size: 22px;
    font-weight: 700;
    color: #0f172a;
  }
  .hp-main-code {
    font-size: 12px;
    padding: 4px 10px;
    border-radius: 999px;
    background: #eff6ff;
    color: #1d4ed8;
    border: 1px solid #bfdbfe;
  }

  .hp-sub-row {
    display: flex;
    flex-wrap: wrap;
    gap: 8px 16px;
    font-size: 13px;
    color: #4b5563;
  }

  .hp-badge {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    font-size: 12px;
    padding: 4px 10px;
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    background: #f9fafb;
    color: #374151;
  }
  .hp-badge-status-ok {
    background: #ecfdf3;
    color: #166534;
    border-color: #bbf7d0;
  }
  .hp-badge-status-maint {
    background: #eff6ff;
    color: #1d4ed8;
    border-color: #bfdbfe;
  }
  .hp-badge-status-stop {
    background: #fef2f2;
    color: #b91c1c;
    border-color: #fecaca;
  }

  .hp-actions {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
  }
  .hp-btn {
    border-radius: 999px;
    border: 1px solid #e5e7eb;
    background: #ffffff;
    padding: 6px 14px;
    font-size: 13px;
    cursor: pointer;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .hp-btn-primary {
    background: #2563eb;
    color: #ffffff;
    border-color: #2563eb;
  }
  .hp-btn span {
    font-size: 14px;
  }

  /* ========= LAYOUT & CARD ========= */
  .hp-layout {
    display: grid;
    grid-template-columns: minmax(0, 1.1fr) minmax(0, 0.9fr);
    gap: 16px;
    margin-bottom: 18px;
  }

  .hp-card,
  .hp-history-card,
  .hp-fuzzy-card {
    background: #ffffff;
    border-radius: 20px;
    padding: 16px 16px 14px;
    border: 1px solid #e5e7eb;
    box-shadow: 0 8px 24px rgba(15, 23, 42, 0.04);
  }

  .hp-card-header,
  .hp-history-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 6px;
  }

  .hp-card-title,
  .hp-history-title {
    font-size: 15px;
    font-weight: 600;
    color: #111827;
  }

  .hp-card-sub {
    font-size: 12px;
    color: #6b7280;
  }

  .hp-info-grid {
    display: grid;
    grid-template-columns: 1.1fr 1fr;
    gap: 8px 16px;
    margin-top: 10px;
    font-size: 13px;
  }
  .hp-info-item-label {
    font-size: 12px;
    color: #6b7280;
    margin-bottom: 2px;
  }
  .hp-info-item-value {
    font-size: 13px;
    color: #111827;
    font-weight: 500;
  }

  .hp-divider {
    border-top: 1px dashed #e5e7eb;
    margin: 10px 0;
  }

  /* ========= THANH TR·∫†NG TH√ÅI ========= */
  .hp-health-box {
    margin-top: 8px;
    padding: 8px 10px;
    border-radius: 14px;
    background: #f9fafb;
    display: flex;
    align-items: center;
    gap: 10px;
  }
  .hp-health-label {
    font-size: 12px;
    color: #6b7280;
    white-space: nowrap;
  }
  .hp-health-bar-wrap {
    flex: 1;
  }
  .hp-health-bar {
    position: relative;
    width: 100%;
    height: 8px;
    border-radius: 999px;
    background: #f3f4f6;
    overflow: hidden;
  }
  .hp-health-bar-inner {
    position: absolute;
    inset: 0;
    width: 85%; /* t·∫°m th·ªùi c·ªë ƒë·ªãnh, sau n√†y c√≥ th·ªÉ t√≠nh theo % m√≤n */
    background: linear-gradient(to right, #22c55e, #16a34a);
  }
  .hp-health-score {
    font-size: 12px;
    font-weight: 600;
    color: #15803d;
    white-space: nowrap;
  }

  /* ========= L·ªäCH S·ª¨ ========= */
  .hp-history-filter {
    font-size: 12px;
    color: #6b7280;
  }

  .hp-table-wrapper {
    width: 100%;
    overflow-x: auto;
  }
  table.hp-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }
  .hp-table thead {
    background: #f9fafb;
  }
  .hp-table th,
  .hp-table td {
    padding: 8px 10px;
    text-align: left;
    border-bottom: 1px solid #f3f4f6;
    white-space: nowrap;
  }
  .hp-table th {
    font-weight: 600;
    color: #4b5563;
  }
  .hp-table td {
    color: #111827;
  }

  .hp-chip {
    display: inline-flex;
    align-items: center;
    padding: 3px 8px;
    border-radius: 999px;
    font-size: 11px;
    border: 1px solid #e5e7eb;
    background: #f9fafb;
  }

  /* ========= FUZZY ========= */
  .hp-fuzzy-card {
    margin-top: 16px;
  }

  .hp-fuzzy-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 10px;
  }
  .hp-fuzzy-title {
    font-size: 15px;
    font-weight: 600;
    color: #111827;
  }
  .hp-fuzzy-note {
    font-size: 12px;
    color: #6b7280;
  }

  .hp-fuzzy-summary {
    display: flex;
    align-items: center;
    flex-wrap: wrap;
    gap: 8px;
    padding: 8px 10px;
    border-radius: 12px;
    background: #f9fafb;
    margin-bottom: 10px;
  }
  .hp-fuzzy-summary-label {
    font-size: 12px;
    color: #6b7280;
  }
  .hp-fuzzy-summary-value {
    font-size: 13px;
    font-weight: 600;
  }
  .hp-fuzzy-summary-value-ok {
    color: #166534;
  }
  .hp-fuzzy-summary-chip {
    font-size: 11px;
    padding: 3px 8px;
    border-radius: 999px;
    border: 1px solid #bbf7d0;
    background: #ecfdf3;
    color: #166534;
  }

  .hp-fuzzy-table-wrapper {
    width: 100%;
    overflow-x: auto;
  }
  table.hp-fuzzy-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 12px;
  }
  .hp-fuzzy-table thead {
    background: #f9fafb;
  }
  .hp-fuzzy-table th,
  .hp-fuzzy-table td {
    padding: 6px 8px;
    text-align: left;
    border-bottom: 1px solid #f3f4f6;
    white-space: nowrap;
  }
  .hp-fuzzy-table th {
    font-weight: 600;
    color: #4b5563;
  }
  .hp-fuzzy-table td {
    color: #111827;
  }

  .hp-fuzzy-subtitle {
    font-size: 13px;
    font-weight: 600;
    color: #374151;
    margin-bottom: 6px;
  }

  @media (max-width: 900px) {
    .hp-layout {
      grid-template-columns: minmax(0, 1fr);
    }
    .hp-header {
      flex-direction: column;
      align-items: flex-start;
    }
  }
</style>
{% endblock %}

{% block content %}
<div class="holder-page">
  <!-- Breadcrumb -->
  <div class="hp-breadcrumb">
    <a href="#">Kho c√¥ng c·ª•</a>
    <span>/</span>
    <a href="#">Danh s√°ch Holder</a>
    <span>/</span>
    <span>{{ holder.ma_noi_bo }}</span>
  </div>

  <!-- Header -->
  <div class="hp-header">
    <div class="hp-title-block">
      <div class="hp-main-title-row">
        <div class="hp-main-title">
          {{ holder.ten_thiet_bi|default:"(Ch∆∞a c√≥ t√™n thi·∫øt b·ªã)" }}
        </div>
        <div class="hp-main-code">
          M√£: {{ holder.ma_noi_bo|default:"-" }}
        </div>
      </div>

      <div class="hp-sub-row">
        <div>Nh√≥m: <strong>{{ holder.nhom_thiet_bi|default:"-" }}</strong></div>
        <div>Lo·∫°i holder: <strong>{{ holder.loai_holder|default:"-" }}</strong></div>
        <div>Nh√† s·∫£n xu·∫•t: <strong>{{ holder.nha_san_xuat|default:"-" }}</strong></div>
        <div>Nh√† cung c·∫•p: <strong>{{ holder.nha_cung_cap|default:"-" }}</strong></div>
      </div>

      <div class="hp-sub-row">
        {% if holder.trang_thai_tai_san == "dang_su_dung" %}
          <span class="hp-badge hp-badge-status-ok">
            {{ holder.get_trang_thai_tai_san_display }}
          </span>
        {% elif holder.trang_thai_tai_san == "dang_bao_tri" %}
          <span class="hp-badge hp-badge-status-maint">
            {{ holder.get_trang_thai_tai_san_display }}
          </span>
        {% elif holder.trang_thai_tai_san == "ngung_su_dung" %}
          <span class="hp-badge hp-badge-status-stop">
            {{ holder.get_trang_thai_tai_san_display }}
          </span>
        {% else %}
          <span class="hp-badge">Ch∆∞a ƒë·∫∑t tr·∫°ng th√°i</span>
        {% endif %}

        <span class="hp-badge">
          V·ªã tr√≠:
          T·ªß {{ holder.tu|default:"-" }} - NgƒÉn {{ holder.ngan|default:"-" }}
        </span>

        <span class="hp-badge">
          M√°y ∆∞u ti√™n: {{ holder.may_uu_tien|default:"-" }}
        </span>

        {% if holder.chu_ky_kiem_tra %}
        <span class="hp-badge hp-badge-status-maint">
          Chu k·ª≥ ki·ªÉm tra: {{ holder.chu_ky_kiem_tra }}
        </span>
        {% endif %}
      </div>
    </div>
    <div class="hp-actions">
      <a href="{% url 'holder_muontra:borrow_for_holder' holder.id %}" class="hp-btn hp-btn-primary">
        <span>üìÑ</span> T·∫°o phi·∫øu m∆∞·ª£n
      </a>
    </div>
  </div>

  <!-- Layout 2 c·ªôt -->
  <div class="hp-layout">
    <!-- TH√îNG TIN CHUNG -->
    <div class="hp-card">
      <div class="hp-card-header">
        <div>
          <div class="hp-card-title">Th√¥ng tin chung</div>
          <div class="hp-card-sub">Th√¥ng tin nh·∫≠n d·∫°ng v√† qu·∫£n l√Ω Holder</div>
        </div>
        <span class="hp-badge">ID n·ªôi b·ªô: {{ holder.id }}</span>
      </div>

      <div class="hp-info-grid">
        <div>
          <div class="hp-info-item-label">T√™n thi·∫øt b·ªã</div>
          <div class="hp-info-item-value">
            {{ holder.ten_thiet_bi|default:"-" }}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">Nh√≥m thi·∫øt b·ªã</div>
          <div class="hp-info-item-value">
            {{ holder.nhom_thiet_bi|default:"-" }}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">M√£ nh√† s·∫£n xu·∫•t</div>
          <div class="hp-info-item-value">
            {{ holder.ma_nha_sx|default:"-" }}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">S·ªë serial</div>
          <div class="hp-info-item-value">
            {{ holder.so_serial|default:"-" }}
          </div>
        </div>
      </div>

      <div class="hp-divider"></div>

      <div class="hp-info-grid">
        <div>
          <div class="hp-info-item-label">Ng√†y nh·∫≠p kho</div>
          <div class="hp-info-item-value">
            {% if holder.ngay_nhap_kho %}
              {{ holder.ngay_nhap_kho|date:"d/m/Y" }}
            {% else %}
              -
            {% endif %}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">Gi√° tr·ªã mua</div>
          <div class="hp-info-item-value">
            {% if holder.gia_tri_mua %}
              {{ holder.gia_tri_mua|floatformat:0 }} ƒë
            {% else %}
              -
            {% endif %}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">Tr·∫°ng th√°i t√†i s·∫£n</div>
          <div class="hp-info-item-value">
            {{ holder.get_trang_thai_tai_san_display|default:"-" }}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">Ng∆∞·ªùi qu·∫£n l√Ω</div>
          <div class="hp-info-item-value">
            {{ holder.nguoi_quan_ly|default:"-" }}
          </div>
        </div>
      </div>

      {% if holder.mon %}
      <div class="hp-health-box">
        <div class="hp-health-label">T√¨nh tr·∫°ng t·ªïng th·ªÉ</div>
        <div class="hp-health-bar-wrap">
          <div class="hp-health-bar">
            <div class="hp-health-bar-inner"></div>
          </div>
        </div>
        <div class="hp-health-score">
          M√≤n: {{ holder.mon }}%
        </div>
      </div>
      {% endif %}
    </div>

    <!-- TH√îNG S·ªê & T√åNH TR·∫†NG K·ª∏ THU·∫¨T -->
    <div class="hp-card">
      <div class="hp-card-header">
        <div>
          <div class="hp-card-title">Th√¥ng s·ªë k·ªπ thu·∫≠t & t√¨nh tr·∫°ng</div>
          <div class="hp-card-sub">D√πng ƒë·ªÉ ch·ªçn Tool ph√π h·ª£p v√† qu·∫£n l√Ω ch·∫•t l∆∞·ª£ng</div>
        </div>
      </div>

      <div class="hp-info-grid">
        <div>
          <div class="hp-info-item-label">Chu·∫©n g√°</div>
          <div class="hp-info-item-value">
            {{ holder.chuan_ga|default:"-" }}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">Lo·∫°i k·∫πp</div>
          <div class="hp-info-item-value">
            {{ holder.loai_kep|default:"-" }}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">Chi·ªÅu d√†i l√†m vi·ªác</div>
          <div class="hp-info-item-value">
            {% if holder.chieu_dai_lam_viec %}
              {{ holder.chieu_dai_lam_viec }} mm
            {% else %}
              -
            {% endif %}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">ƒê∆∞·ªùng k√≠nh k·∫πp max</div>
          <div class="hp-info-item-value">
            {% if holder.duong_kinh_kep_max %}
              {{ holder.duong_kinh_kep_max }} mm
            {% else %}
              -
            {% endif %}
          </div>
        </div>
      </div>

      <div class="hp-divider"></div>

      <div class="hp-info-grid">
        <div>
          <div class="hp-info-item-label">L·∫ßn ki·ªÉm tra g·∫ßn nh·∫•t</div>
          <div class="hp-info-item-value">
            {% if holder.lan_kiem_tra_gan_nhat %}
              {{ holder.lan_kiem_tra_gan_nhat|date:"d/m/Y" }}
            {% else %}
              -
            {% endif %}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">Chu k·ª≥ ki·ªÉm tra</div>
          <div class="hp-info-item-value">
            {{ holder.chu_ky_kiem_tra|default:"-" }}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">S·ªë l·∫ßn g√° / th√°o</div>
          <div class="hp-info-item-value">
            {{ holder.so_lan_ga_thao|default:"-" }}
          </div>
        </div>
        <div>
          <div class="hp-info-item-label">ƒê√°nh gi√° g·∫ßn nh·∫•t</div>
          <div class="hp-info-item-value">
            {{ holder.danh_gia_gan_nhat|default:"-" }}
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- L·ªäCH S·ª¨ M∆Ø·ª¢N / TR·∫¢ & B·∫¢O TR√å (t·∫°m th·ªùi ch∆∞a c√≥ model n√™n ƒë·ªÉ placeholder) -->
  <div class="hp-history-card">
    <div class="hp-history-header">
      <div class="hp-history-title">L·ªãch s·ª≠ m∆∞·ª£n / tr·∫£ & b·∫£o tr√¨</div>
      <div class="hp-history-filter">Ch∆∞a k·∫øt n·ªëi d·ªØ li·ªáu l·ªãch s·ª≠ (s·∫Ω b·ªï sung sau)</div>
    </div>

    <div class="hp-table-wrapper">
      <table class="hp-table">
        <thead>
          <tr>
            <th>Ng√†y</th>
            <th>Lo·∫°i phi·∫øu</th>
            <th>Ng∆∞·ªùi thao t√°c</th>
            <th>M√°y / Line</th>
            <th>Ghi ch√∫</th>
            <th>Tr·∫°ng th√°i</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td colspan="6" style="text-align:center;color:#9ca3af;padding:10px;">
              Ch∆∞a c√≥ d·ªØ li·ªáu l·ªãch s·ª≠. T·∫°o model phi·∫øu m∆∞·ª£n / b·∫£o tr√¨ ƒë·ªÉ hi·ªÉn th·ªã t·∫°i ƒë√¢y.
            </td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>

  <!-- ƒê√ÅNH GI√Å FUZZY CHO HOLDER -->
  <div class="hp-fuzzy-card">
    <div class="hp-fuzzy-header">
      <div class="hp-fuzzy-title">ƒê√°nh gi√° fuzzy cho Holder n√†y</div>
      <div class="hp-fuzzy-note">K·∫øt qu·∫£ suy lu·∫≠n t·ª´ c√°c ti√™u ch√≠ k·ªπ thu·∫≠t.</div>
    </div>

    <div class="hp-fuzzy-summary">
      <span class="hp-fuzzy-summary-label">K·∫øt lu·∫≠n chung:</span>
      <span class="hp-fuzzy-summary-value hp-fuzzy-summary-value-ok">
        {{ holder.ket_luan_fuzzy|default:"Ch∆∞a c√≥ k·∫øt lu·∫≠n fuzzy. B·∫°n c√≥ th·ªÉ t√≠nh to√°n v√† l∆∞u v√†o tr∆∞·ªùng 'ket_luan_fuzzy'." }}
      </span>
    </div>

    <div class="hp-fuzzy-table-wrapper">
      <div class="hp-fuzzy-subtitle">Chi ti·∫øt c√°c ti√™u ch√≠ fuzzy</div>
      <table class="hp-fuzzy-table">
        <thead>
          <tr>
            <th>Ti√™u ch√≠</th>
            <th>Gi√° tr·ªã ƒëo ƒë∆∞·ª£c</th>
            <th>Ghi ch√∫</th>
          </tr>
        </thead>
        <tbody>
          <tr>
            <td>ƒê·ªô c·ª©ng v·ªØng (CV)</td>
            <td>{{ holder.cv|default:"-" }}/10</td>
            <td></td>
          </tr>
          <tr>
            <td>ƒê·ªô ch√≠nh x√°c g√° k·∫πp (DX)</td>
            <td>{{ holder.dx|default:"-" }}/10</td>
            <td></td>
          </tr>
          <tr>
            <td>Chi·ªÅu d√†i nh√¥ dao (LD)</td>
            <td>
              {% if holder.ld %}
                {{ holder.ld }} mm
              {% else %}
                -
              {% endif %}
            </td>
            <td></td>
          </tr>
          <tr>
            <td>T√¨nh tr·∫°ng m√≤n (%)</td>
            <td>{{ holder.mon|default:"-" }}%</td>
            <td></td>
          </tr>
          <tr>
            <td>T·∫ßn su·∫•t s·ª≠ d·ª•ng (l·∫ßn/th√°ng)</td>
            <td>{{ holder.tan_suat|default:"-" }}</td>
            <td></td>
          </tr>
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
