{% extends "base.html" %}

{% block title %}Qu·∫£n l√Ω m∆∞·ª£n / xu·∫•t tool - TMS Web{% endblock %}

{% block extra_css %}
<style>
  .borrow-page {
      max-width: 1120px;
      margin: 0 auto;
      padding: 8px 0 32px;
  }

  /* ===== HEADER TRANG ===== */
  .bp-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 16px;
      margin-bottom: 16px;
  }
  .bp-title-block {
      display: flex;
      flex-direction: column;
      gap: 4px;
  }
  .bp-title {
      font-size: 22px;
      font-weight: 700;
      color: var(--blue-strong);
      letter-spacing: 0.04em;
      text-transform: uppercase;
  }
  .bp-sub {
      font-size: 13px;
      color: #6b7280;
  }

  .bp-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 8px;
  }
  .btn-history {
      padding: 8px 14px;
      border-radius: 999px;
      border: 1px solid #e5e7eb;
      background: #f9fafb;
      font-size: 13px;
      text-decoration: none;
      color: #374151;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: background 0.15s, box-shadow 0.15s, transform 0.1s, border-color 0.15s;
  }
  .btn-history span {
      font-size: 15px;
  }
  .btn-history:hover {
      background: var(--blue-soft);
      border-color: var(--blue-tech);
      box-shadow: 0 4px 12px rgba(15, 23, 42, 0.12);
      transform: translateY(-1px);
  }

  /* ===== CARD (ƒë·ªìng b·ªô style v·ªõi search-card) ===== */
  .bp-card {
      background: #ffffff;
      border-radius: 24px;
      padding: 18px 18px 14px;
      box-shadow: 0 16px 40px rgba(15, 23, 42, 0.06);
      border: 1px solid #e5e7eb;
      margin-bottom: 24px;
  }
  .bp-card-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      gap: 10px;
      margin-bottom: 10px;
  }
  .bp-card-title {
      font-size: 15px;
      font-weight: 600;
      color: var(--blue-strong);
  }
  .bp-card-sub {
      font-size: 12px;
      color: #6b7280;
  }
  .bp-card-right {
      font-size: 12px;
      color: #9ca3af;
      white-space: nowrap;
  }

  /* ===== TABLE ===== */
  .bp-table-wrapper {
      border-radius: 18px;
      border: 1px solid #e5e7eb;
      overflow: auto;
      max-height: 420px;
  }
  table.bp-table {
      width: 100%;
      border-collapse: collapse;
      font-size: 13px;
  }
  .bp-table th,
  .bp-table td {
      padding: 8px 11px;
      border-bottom: 1px solid #f3f4f6;
      white-space: nowrap;
  }
  .bp-table th {
      background: #f9fafb;
      text-transform: uppercase;
      font-size: 12px;
      font-weight: 600;
      color: #4b5563;
  }
  .bp-table tbody tr:nth-child(even) {
      background: #f9fafb;
  }
  .bp-table tbody tr:hover {
      background: #eff6ff;
  }

  .bp-badge {
      display: inline-flex;
      align-items: center;
      padding: 2px 8px;
      border-radius: 999px;
      font-size: 11px;
      background: var(--blue-soft);
      color: var(--blue-strong);
  }

  /* ===== BUTTON NH·ªé (theo m√†u xanh h·ªá th·ªëng) ===== */
  .btn-small {
      padding: 6px 10px;
      font-size: 11px;
      border-radius: 999px;
      border: 1px solid var(--blue-tech);
      cursor: pointer;
      text-decoration: none;
      display: inline-flex;
      align-items: center;
      gap: 4px;
      background: var(--blue-tech);
      color: #0f172a;
      font-weight: 600;
      transition: background 0.15s, box-shadow 0.15s, transform 0.05s, color 0.15s;
  }
  .btn-small:hover {
      background: #0ea5e9;
      box-shadow: 0 4px 10px rgba(56, 189, 248, 0.35);
      transform: translateY(-1px);
  }
  .btn-small.neutral {
      background: #f9fafb;
      border-color: #d1d5db;
      color: #111827;
      font-weight: 500;
  }
  .btn-small.neutral:hover {
      background: #e5e7eb;
      box-shadow: 0 4px 10px rgba(107, 114, 128, 0.25);
  }

  @media (max-width: 640px) {
      .bp-header {
          flex-direction: column;
          align-items: flex-start;
      }
  }
</style>
{% endblock %}

{% block content %}
<div class="borrow-page">

    <!-- HEADER -->
    <div class="bp-header">
        <div class="bp-title-block">
            <div class="bp-title">Qu·∫£n l√Ω m∆∞·ª£n / xu·∫•t tool</div>
            <p class="bp-sub">
                Holder l√† ƒë·ªëi t∆∞·ª£ng m∆∞·ª£n / tr·∫£. Tool ti√™u hao ch·ªß y·∫øu xu·∫•t 1 chi·ªÅu ƒë·ªÉ tr·ª´ t·ªìn kho.
            </p>
        </div>

        <div class="bp-actions">
            <a href="{% url 'holder_muontra:history_holder' %}" class="btn-history">
                üë§ <span>L·ªãch s·ª≠ Holder</span>
            </a>
            <a href="{% url 'tool_muontra:history_tool' %}" class="btn-history">
                üõ†Ô∏è <span>L·ªãch s·ª≠ Tool</span>
            </a>
        </div>
    </div>

    <!-- ===== B·∫¢NG TOOL (TR√äN) ===== -->
    <div class="bp-card">
        <div class="bp-card-header">
            <div>
                <div class="bp-card-title">Danh s√°ch Tool</div>
                <div class="bp-card-sub">
                    D·ª•ng c·ª• / ti√™u hao ‚Äì xin xu·∫•t kho 1 chi·ªÅu, d√πng ƒë·ªÉ theo d√µi t·ªìn.
                </div>
            </div>
            <div class="bp-card-right">
                T·ªïng: {{ tools|length }} tool
            </div>
        </div>

        <div class="bp-table-wrapper">
            <table class="bp-table">
                <thead>
                <tr>
                    <th>M√£</th>
                    <th>T√™n tool</th>
                    <th>Nh√≥m</th>
                    <th>T·ªìn</th>
                    <th>Thao t√°c</th>
                </tr>
                </thead>
                <tbody>
                {% for tool in tools %}
                    <tr>
                        <td>{{ tool.ma_tool }}</td>
                        <td>{{ tool.ten_tool }}</td>
                        <td>{{ tool.nhom_tool }}</td>
                        <td>
                            <span class="bp-badge">
                                {{ tool.ton_kho|default:"-" }}
                            </span>
                        </td>
                        <td>
                            <!-- Xin xu·∫•t kho tool -->
                            <a href="{% url 'tool_muontra:tool_transaction_create' tool.id %}" class="btn-small">
                                üì¶ Xin xu·∫•t kho
                            </a>
                        </td>
                    </tr>
                {% empty %}
                    <tr>
                        <td colspan="5">Ch∆∞a c√≥ tool n√†o.</td>
                    </tr>
                {% endfor %}
                </tbody>
            </table>
        </div>
    </div>

    <!-- ===== B·∫¢NG HOLDER (D∆Ø·ªöI) ===== -->
    <div class="bp-card">
        <div class="bp-card-header">
            <div>
                <div class="bp-card-title">Danh s√°ch Holder</div>
                <div class="bp-card-sub">
                    Ch·ªçn holder ƒë·ªÉ xu·∫•t tool ho·∫∑c x·ª≠ l√Ω tr·∫£ / ƒë√≥ng phi·∫øu.
                </div>
            </div>
            <div class="bp-card-right">
                T·ªïng: {{ holders|length }} holder
            </div>
        </div>

        <div class="bp-table-wrapper">
            <table class="bp-table">
           <thead>
<tr>
  <th>M√£</th>
  <th>T√™n holder</th>
  <th>Nh√≥m</th>
  <th>ƒê·ªô b·ªÅn</th>
  <th>Tr·∫°ng th√°i</th>
  <th>Thao t√°c</th>
  <th>ƒê√°nh gi√°</th>
</tr>
</thead>

<tbody>
{% for holder in holders %}
  <tr>
    <td>{{ holder.ma_noi_bo }}</td>
    <td>{{ holder.ten_thiet_bi }}</td>
    <td>{{ holder.nhom_thiet_bi }}</td>

    <td>
      {% if holder.mon is not None %}
        <span class="bp-badge">{{ holder.mon }}%</span>
      {% else %}
        ‚Äî
      {% endif %}
    </td>

    <td>
      <span class="bp-badge">{{ holder.get_trang_thai_tai_san_display }}</span>
    </td>

    <td>
      {% if holder.trang_thai_tai_san == "san_sang" %}
        <a href="{% url 'holder_muontra:borrow_for_holder' holder.id %}" class="btn-small">
          ‚ûï M∆∞·ª£n
        </a>

      {% elif holder.trang_thai_tai_san == "dang_duoc_muon" %}
        <a href="{% url 'holder_muontra:return_for_holder' holder.id %}" class="btn-small neutral">
          ‚Ü©Ô∏è Tr·∫£ / ƒë√≥ng
        </a>

      {% else %}
        <span class="bp-badge">‚Äî</span>
      {% endif %}
    </td>

    <td>
      <span class="bp-badge">{{ holder.danh_gia_gan_nhat|default:"-" }}</span>
    </td>
  </tr>
{% empty %}
  <tr>
    <td colspan="7">Ch∆∞a c√≥ holder n√†o.</td>
  </tr>
{% endfor %}
</tbody>

            </table>
        </div>
    </div>

</div>
{% endblock %}
